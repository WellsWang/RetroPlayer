# RetroPlayer

RetroPlayer 项目旨在创造一个可以播放AMIGA计算机时代流行的MOD音乐格式的实体复古音乐播放器。该播放器基于ESP32实现，支持显示歌曲信息和播放控制，并通过旋转编码器进行操作。

## 功能

- **MOD音乐**：RetroPlayer可以播放存储在TF卡上的海量的AMIGA MOD音乐，MOD音乐在上世纪90年代非常流行，也是Demoscene文化中不可或缺的组成部分；
- **乐曲信息显示**： 可以通过OLED屏幕显示正在播放的乐曲的相关信息；
- **单一操控**：可以通过一个旋钮驱动旋转编码器方便地操作控制播放行为；
- **木制外壳**：虽然可以使用其它材质，但还是推荐使用实木制作，以便于得到温润厚实的手感。

## 从这里开始

### 前置准备

- 支持ESP32开发板的Arduino IDE环境
- 安装ESP8266Audio、Adafruit_SSD1306以及其依赖的函数库
- BOM表中涉及到的所有电子元器件
- 根据Gerber文件制作的PCB
- 一些板材，木材或亚克力板（2mm和1mm两种厚度规格，表层贴皮可以采用0.5mm厚度的木皮）
- 激光雕刻机或者其他能切割板材的装置（或者可以找代工商解决）
- 电烙铁和焊接耗材
- 灵巧的双手
- 耐心和面对挑战勇气

### 代码下载和说明

#### 代码下载
1. Clone the repository:
   ```sh
   git clone https://github.com/WellsWang/RetroPlayer.git
   cd RetroPlayer
   ```

 2. 直接下载zip文件，使用解压缩软件解开压缩包

#### 目录结构
- pcb  `电路设计相关`
	- BOM `物料表`
	- Gerber `PCB制作文件`
	- Schematics `电路原理图`
- shell `外壳设计相关`
	- 3D_Model `三维建模文件（效果验证）`
	- 2D_CAD `CAD文件，用于板材切割`
- src `源代码相关`
	- ESP8266Audio_mod_src `ESP8266Audio库中的部分需要修改定制的文件`
	- RetroPlayer25 `项目源代码`

#### 代码安装注意事项
由于ESP8266Audio库只提供了基本的文件解析和音频信号生成操作，一些我们所需要的功能并未实现，因此本项目修改了ESP8266Audio库中和MOD文件相关的部分代码并做了扩展。在编译前，需要将`src/ESP8266Audio_mod_src`目录中的文件复制到Arduino IDE使用的ESP8266Audio函数库目录中，替换掉源文件。在替换前建议对原文件进行备份。

在Windows环境下，Arduino IDE的函数库一般位于`C:\Users\用户名\Documents\Arduino\libraries`，而在Linux环境，一般位于`/home/用户名/Arduino/libraries`。

#### 电路设计安装说明
`Schematics` 目录中存放了电路原理设计图，如果您有新的想法或改进的设计，可以进行参考。

在电路图中，并未涉及锂电池充放电模块，可以使用小型的充放电一体电路模块，将5V电源输出接到H1，SW1接到开关。

对于OLED屏幕，本项目中使用的是SSD1306驱动的1.3寸SPI接口的OLED屏幕。如果需要更换其他的OLED屏幕，例如使用SH1106驱动的屏幕，需要修改源代码，建议使用u8glib库并修改对应的驱动代码。另外因为性能的原因，不建议修改为IIC接口。如果需要修改OLED屏幕的尺寸，需要同步修改外壳设计中面板的开孔大小。

在本项目中扬声器使用了4040尺寸的，4欧3W腔体扬声器。注意接线时左右扬声器线序要一致。

在电路图第三页（音频部分）中，R26和R27为两个0欧电阻，用于跳线选择。这两个电阻只需要焊接一个，建议选择只焊接R27。这种场景下，如有外接耳机、音箱插入3.5mmm音频插孔，播放器自身的扬声器将静音，只通过3.5mm音频接口输出。R26是用于测试的，如果只焊接R26，插入耳机时，扬声器依旧有声音输出，且会随着耳机插入改变声音强度。

#### 外壳设计组装说明
外壳可以使用木板或亚克力板来构建。可以使用`2D_CAD`目录中的dxf文件进行板材切割。

外壳板材除了绘制在最右侧的音箱网罩板和中央面板外，一般都使用2mm厚度的板材进行切割。音箱网罩板和中央面板使用1mm厚度的板材切割。

切割后的板材可以参考`3D_Model`目录中的三维建模来进行组装。该文件可以使用Sketchup软件打开。

如果想遮盖板材拼接的接口，可以使用`2D_CAD/2D加工图_贴皮.dxf`这个文件对表面贴皮进行切割。贴皮可以使用厚度低于0.5mm的材料，例如胡桃木皮。

音箱网罩板使用尼龙钉与播放器主体进行卡扣连接，推荐使用3.3*13黑色尼龙钉。音箱网罩板上的蒙布需要使用专用胶水粘贴。

音箱铭牌为可选安装件。

## 未来计划与代码贡献
此项目为业余项目，虽然有很多想法，例如：
- 更完善的播放模式选择（随机，循环控制）
- 更多的歌曲信息显示（播放时长、当前音符信息）
- 更多的音乐格式（ESP8266Audio支持很多音乐格式）
- 互联网播放支持（可以直接播放modarchive.org网站的内容）
- ……还有好多想法……

但是，个人时间有限，所以，也许在未来的某一天会对此项目进行更新。

因此，非常欢迎大家fork此项目并对项目代码进行优化、改进或实现你自己的想法。
在此，先对大家的代码贡献做出感谢，谢谢大家的支持！

## 许可证
本项目基于GNU General Public License v3.0许可证发布。具体信息请参考LICENSE文件。
本项目及开发人员不对本项目中包含的所有信息、代码的质量、使用效果、带来的影响作出任何承诺，您需要自行进行判断并承担相应的责任。

## Acknowledgments
Inspiration from the classic Amiga computers and their unique sound capabilities.

ESP8266Audio library for MOD file handling. (https://github.com/earlephilhower/ESP8266Audio)

Adafriut SSD1306 library for OLED display handling. (https://github.com/adafruit/Adafruit_SSD1306)
